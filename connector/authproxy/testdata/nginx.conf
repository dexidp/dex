events {
    worker_connections 128;
}

http {
    # The upstream is the Go test server started on a fixed port.
    upstream backend {
        server host.docker.internal:18562;
    }

    server {
        listen 80;

        # Default headers scenario: all X-Remote-* headers set.
        location /default {
            proxy_set_header X-Remote-User "testuser";
            proxy_set_header X-Remote-User-Id "uid-12345";
            proxy_set_header X-Remote-User-Email "testuser@example.com";
            proxy_set_header X-Remote-User-Name "Test User";
            proxy_set_header X-Remote-Group "group1, group2, group3";
            proxy_pass http://backend;
        }

        # Only X-Remote-User header set; other fields should fall back to it.
        location /minimal {
            proxy_set_header X-Remote-User "janedoe";
            proxy_set_header X-Remote-User-Id "";
            proxy_set_header X-Remote-User-Email "";
            proxy_set_header X-Remote-User-Name "";
            proxy_set_header X-Remote-Group "";
            proxy_pass http://backend;
        }

        # No auth headers: connector should return an error.
        location /no-headers {
            proxy_set_header X-Remote-User "";
            proxy_set_header X-Remote-User-Id "";
            proxy_set_header X-Remote-User-Email "";
            proxy_set_header X-Remote-User-Name "";
            proxy_set_header X-Remote-Group "";
            proxy_pass http://backend;
        }

        # Custom separator scenario: groups separated by ";".
        location /custom-separator {
            proxy_set_header X-Remote-User "johndoe";
            proxy_set_header X-Remote-User-Id "uid-99999";
            proxy_set_header X-Remote-User-Email "johndoe@example.com";
            proxy_set_header X-Remote-User-Name "John Doe";
            proxy_set_header X-Remote-Group "admins;developers;ops";
            proxy_pass http://backend;
        }
    }
}

